<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
          integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/updateplace.css}"/>
    <title>Tripcok - Admin</title>
</head>
<body>
<div class="container">
    <!-- Navigation -->
    <div class="navigation-container">
        <div style="height:100%" th:insert="~{fragments/menu :: menu-list}"></div>
    </div>

    <!-- Main Content -->
    <div class="content-container">
        <div class="content-header d-flex justify-content-between align-items-center">
            <h1>View Places</h1>
            <div class="logo-container">
                <p>Trip</p>
                <p style="color: #6DB777">Cok</p>
            </div>
        </div>

        <div class="content-search">
            <div>
                <p>Update Place</p>
            </div>
        </div>
        <!-- 여행지 수정 부분 -->
        <div class="update-content">
            <!-- 왼쪽 박스 -->
            <div class="left-box">
                <div class="left-column1">
                    <p>여행지</p>
                    <input id="PlaceName" placeholder="여행지를 입력하세요." type="text">
                </div>

                <div class="left-column2">
                    <p>주소</p>
                    <input id="Address" placeholder="주소를 입력하세요." type="text">
                </div>

                <div class="left-column3">
                    <p>설명</p>
                    <textarea class="description" id="Description" placeholder="여행지에 대한 설명을 입력하세요."></textarea>
                </div>
            </div>
            <!-- 오른쪽 박스 -->
            <div class="right-box">
                <div class="dropdown right-column1-dropdown">
                    <p>카테고리 선택</p>
                    <a class="btn btn-secondary dropdown-toggle"
                       href="#"
                       role="button"
                       data-bs-toggle="dropdown"
                       aria-expanded="false">
                        <span id="CategoriesLabel">카테고리를 선택하세요.</span>
                    </a>

                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" data-id="1">힐링</a></li>
                        <li><a class="dropdown-item" href="#" data-id="2">자연</a></li>
                        <li><a class="dropdown-item" href="#" data-id="3">캠핑</a></li>
                    </ul>
                </div>

                <div class="right-column2">
                    <p>사진 등록하기</p>
                    <div class="add-photo">
                        <div class="add-photo-nav">
                            <div class="add-photo-icon-box" id="addPhotoIcon">
                                <i class="bi bi-plus-square-fill"></i>
                            </div>
                        </div>
                        <div class="add-photo-cards" id="photoPreview">
                            <!-- 파일이 추가되면 여기에 표시 -->
                        </div>
                        <input type="file" id="placeImages" accept="image/png, image/jpeg" multiple style="display: none;">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="button-container">
        <button class="btn btn-cancel" onclick="window.history.back()" type="button">취소</button>
        <button class="btn btn-update" id="updatePlaceButton" type="submit">수정하기</button>
    </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-Q6N72jH5j1cQI8YX3quyQWUpfMnYjwW3fVXYnK05kwbhPncErfZxi7A+fMwF6xE9"
        crossorigin="anonymous"></script>

<script src="updateplace.js"></script>

<script>
    document.getElementById("updatePlaceButton").addEventListener("click", async function () {
        /* 여행지 수정 API에 전달할 데이터 수집*/
        const placeId = 1;
        const request = {
            placeName: document.getElementById("PlaceName").value,
            address: document.getElementById("Address").value,
            description: document.getElementById("Description").value,
            // 카테고리 id 배열
            categoryIds: selectedCategories
        };

        /* 파일 업로드 데이터 */
        const fileInput = document.getElementById("placeImages");
        const files = fileInput.files;
        const formData = new FormData();

        /* 요청 데이터 */
        formData.append("request", new Blob([JSON.stringify(request)], { type: "application/json" }));

        // 파일 추가
        for (let i = 0; i < files.length; i++) {
            formData.append("file", files[i]);
        }

        try {
            const response = await fetch("/api/vi/place/${placeId}", {
                method: "PUT",
                body: formData,
            });

            if (response.ok) {
                alert('여행지가 성공적으로 수정되었습니다.');
                window.location.reload();
            } else {
                console.error = await response.json();
                alert(`수정 실패:${error.message}`);
            }
        } catch (error) {
            console.error('Error updating place: ', error);
            alert('여행지 수정 중 오류가 발생했습니다.');
        }
    });

</script>


</body>
</html>